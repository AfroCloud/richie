version: "3"
services:
  db:
    image: postgres:9.6
    env_file: env.d/development
    ports:
        - "5440:5432"
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch-oss:6.1.2
  app:
    build: .
    env_file: env.d/development
    ports:
        - "8070:8000"
    volumes:
      - .:/app
      - ./data/static:/data/static
      - ./data/media:/data/media
    depends_on:
      - "db"
      - "elasticsearch"
  nginx:
    image: nginx:1.12.2
    ports:
      - "8071:80"
    volumes:
      - ./docker/etc/nginx/conf.d:/etc/nginx/conf.d:ro
      - ./data/static:/data/static:ro
      - ./data/media:/data/media:ro
    depends_on:
      - "app"
  node:
    image: node:9.4.0
    working_dir: /app
    volumes:
      - .:/app
